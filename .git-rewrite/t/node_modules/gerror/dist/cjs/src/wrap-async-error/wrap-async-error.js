"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.wrapAsyncError = void 0;
const wrapAsyncError = onError => (asyncStaff) => {
    /**
     * 1. Promise
     */
    if (asyncStaff instanceof Promise) {
        asyncStaff
            .then(_ => _)
            .catch(e => onError(e));
        /**
         * Huan(202110) FIXME:
         *  The same code works inside the Wechaty/Puppet class
         *  but here we  have to use `as any` to bypass the type check
         */
        return undefined;
    }
    /**
     * 2. Function
     *  pay attention to `this` because we need to pass it down.
     */
    return function (...args) {
        try {
            const ret = asyncStaff.apply(this, args);
            if (ret instanceof Promise) {
                ret.catch(onError);
            }
            else {
                void ret; // <- Huan(202110): to see what type it is
            }
        }
        catch (e) {
            onError(e);
        }
    };
};
exports.wrapAsyncError = wrapAsyncError;
//# sourceMappingURL=wrap-async-error.js.map