links = ["https://i0.hdslb.com/bfs/article/231a2286704d13675c25df228abed3d2ddbf2d00.jpg","https://i0.hdslb.com/bfs/article/c841534b39133e4e96f8bbb19a4471843243c5d4.jpg","https://i0.hdslb.com/bfs/article/7913498bb634b8a13c1b60dbdcaed4463fa17f50.jpg","https://i0.hdslb.com/bfs/article/ec07923700f633578a681c56a008505893cf47a6.jpg","https://i0.hdslb.com/bfs/article/c2691feff128c0b982d9d28ce798b3a3327fd161.jpg","https://i0.hdslb.com/bfs/article/78d92d8abac6fbb8a1a3c9bcf44b76b9e2b709c9.jpg","https://i0.hdslb.com/bfs/article/1d8bc016bd9593a1ffc7c6ace7a0b6e2795ba24a.jpg","https://i0.hdslb.com/bfs/article/e9a3e50378caf80fa7f1584813e7d88ea5f4e4f3.jpg","https://i0.hdslb.com/bfs/article/b73f8a8bc1f215af7e181e1e5f4a682d353dd7f5.jpg","https://i0.hdslb.com/bfs/article/9ebb2bf93fcd4bf0c0dd413c378ebe6b6c4b436a.jpg","https://i0.hdslb.com/bfs/article/063b2dee6bb57a5de4fd518d671e2fc384089705.jpg","https://i0.hdslb.com/bfs/article/9061adbc1f3fe0a6a591e64972feeef126d405bd.jpg","https://i0.hdslb.com/bfs/article/16a5af1e204e9d99e29ce567da625fe4cbf97654.jpg","https://i0.hdslb.com/bfs/article/064628af3ba2caad6da4f256c1203a2e5abc84d5.jpg","https://i0.hdslb.com/bfs/article/e91f4d2080851dcd3b7d95b5899c3819379e7419.jpg","https://i0.hdslb.com/bfs/article/ed7503d3465cc98c4f33c7269d4003dff5c0e30e.jpg","https://i0.hdslb.com/bfs/article/30ead312e5de86bab22b1408cfd7e343f7a444ba.jpg","https://i0.hdslb.com/bfs/article/8f099a8a276dcc0304d5ab8032bcca6df92fad45.jpg","https://i0.hdslb.com/bfs/article/d64bde431d4696dc049ccc156689d00f8b56d3e4.jpg","https://i0.hdslb.com/bfs/article/e7b7805ffb07eee969a18b543a342290e847a488.jpg","https://i0.hdslb.com/bfs/article/f6aad92efa9a9db5ab650cc9d958899d3eb0ccc5.jpg","https://i0.hdslb.com/bfs/article/e0ef8a4a11c3451a81e8f8a4aea0460f308aed6d.jpg","https://i0.hdslb.com/bfs/article/7000095230b4d1e4e9c82f596228342a38fceb3b.jpg"]


# links = ["https://i0.hdslb.com/bfs/article/328165fb5c73e4b9a11eb335a6ccbad144606495.jpg","https://i0.hdslb.com/bfs/article/02db465212d3c374a43c60fa2625cc1caeaab796.png","https://i0.hdslb.com/bfs/article/ef99b038b6c254b5ee3c77641a2d24523b2f2549.jpg","https://i0.hdslb.com/bfs/article/6831c04615d8c2656bf9edb260b2692600506b12.jpg","https://i0.hdslb.com/bfs/article/b6e798cc616440a2d8f0e3da08f2e47deb3dea5e.jpg","https://i0.hdslb.com/bfs/article/d6a352ed8ef2662b249b31617d16cb7b49012980.jpg","https://i0.hdslb.com/bfs/article/3ece6a53ffc6d1b934830771861087477def3754.jpg","https://i0.hdslb.com/bfs/article/f0207ebb2a7d120ebd22cec39cf242888747f1aa.jpg","https://i0.hdslb.com/bfs/article/fe80a0fcaecbca438a28dcf6d64b2fdfcf0395dd.jpg","https://i0.hdslb.com/bfs/article/6b60f9321e1c902983020925b9cd77eeb90b0d37.jpg","https://i0.hdslb.com/bfs/article/0e4460990f511fdbdd035872d9e4019d1a91a1c2.jpg","https://i0.hdslb.com/bfs/article/92746eb9f9b399b7f959040e4e108099282c7e78.jpg","https://i0.hdslb.com/bfs/article/41cbd61a4ff091d8a812f2c156b41a42e7cfbcee.jpg","https://i0.hdslb.com/bfs/article/419c0b63e00243fd36a664625528817c5e9b56f9.jpg","https://i0.hdslb.com/bfs/article/920f5219d12369d35025f415456a1c8f17af80f0.jpg","https://i0.hdslb.com/bfs/article/f06e85b771817651287a5550a52ab2d407b9bdfd.jpg","https://i0.hdslb.com/bfs/article/4c24e5879af822216e609aa6d7e0aab35fdea868.jpg","https://i0.hdslb.com/bfs/article/3a016ea4f11e086547d5b3cafae7ab4014934415.jpg","https://i0.hdslb.com/bfs/article/57185c84c272c0f9ee70a18a5a969236c43da5d9.jpg","https://i0.hdslb.com/bfs/article/8d2de4ec7b46001041b1b9434f80a4db48cb0182.jpg","https://i0.hdslb.com/bfs/article/780aef80d7246206a5bb4927e2834dc55286fb19.jpg","https://i0.hdslb.com/bfs/article/246967f4d22e55c70666b4ac41205dd2c6cd3cde.jpg","https://i0.hdslb.com/bfs/article/84f521382f7c02e6e4ea0daabb6e93192134372a.jpg","https://i0.hdslb.com/bfs/article/7fd2ad226c81b31d397323891c8194d67f2fdf2b.jpg","https://i0.hdslb.com/bfs/article/eee197d9172b1c38218ab642596b2990afcc383c.jpg","https://i0.hdslb.com/bfs/article/736b5609c526379a8089a7741e19586eebeeb3e2.jpg","https://i0.hdslb.com/bfs/article/93b97faaaa5a14242d21a2e592b03b87fa0c5ff3.jpg","https://i0.hdslb.com/bfs/article/ea528dc4bc964eaf9960fdc9d399b03f87db9ddb.jpg"]

import requests
import cv2 # will it work?
import uuid
import shutil
from test_common import *

# import paddleocr

from paddleocr import PaddleOCR,draw_ocr
basepath = "tarot_pictures"
# basepath = "tarot_pictures2"
# Paddleocr supports Chinese, English, French, German, Korean and Japanese.
# You can set the parameter `lang` as `ch`, `en`, `french`, `german`, `korean`, `japan`
# to switch the language model in order.
ocr = PaddleOCR(use_angle_cls=True, lang='en') # need to run only once to download and load model into memory
# img_path = 'PaddleOCR/doc/imgs_en/img_12.jpg'
# result = ocr.ocr(img_path, cls=True)
# for line in result:
#     print(line)
os.system("rm -rf {}".format(basepath))
os.system("mkdir {}".format(basepath))

for imglink in links:
    print("DOWNLOADING:",imglink)
    while True:
        try:
            r = requests.get(imglink)
            break
        except:
            continue
    data = r.content # save as picture.
    tmpname = "{}.jpg".format(str(uuid.uuid4()))
    tmpname = os.path.join(basepath,tmpname)
    with open(tmpname,"wb") as f:
        f.write(data)
    new_name = []
    picture = cv2.imread(tmpname)
    result = ocr.ocr(picture, cls=True)
    for line in result:
        ((x1,y1),(x2,y2),(x3,y3),(x4,y4)), (string,certainty) = line
        if certainty > 0.7:
            new_name.append(string)
    new_name = "_".join(new_name)
    switch = len(new_name)>3
    if switch:
        new_name = "{}.jpg".format(new_name)
        new_name = os.path.join(basepath,new_name)
        print("NEWNAME:",new_name)
        shutil.move(tmpname,new_name)