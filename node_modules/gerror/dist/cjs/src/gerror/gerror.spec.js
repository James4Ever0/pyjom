#!/usr/bin/env -S node --no-warnings --loader ts-node/esm
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tstest_1 = require("tstest");
const gerror_js_1 = require("./gerror.js");
const grpc_js_1 = require("./grpc.js");
const puppet_js_1 = require("./puppet.js");
(0, tstest_1.test)('GError class smoke testing', async (t) => {
    const MESSAGE = 'test';
    const gerror = gerror_js_1.GError.fromJSON(new Error(MESSAGE));
    const obj = gerror.toJSON();
    t.equal(obj.code, grpc_js_1.Code.UNKNOWN, 'should be default code UNKNOWN');
    t.equal(obj.message, MESSAGE, 'should set message');
});
(0, tstest_1.test)('GError from primitive values', async (t) => {
    const FIXTURES = [
        42,
        'hello world',
        null,
        undefined,
        true,
        false,
        {},
        [],
    ];
    for (const value of FIXTURES) {
        t.doesNotThrow(() => gerror_js_1.GError.from(value), `should not throw for ${typeof value}: "${JSON.stringify(value)}"`);
    }
});
(0, tstest_1.test)('GError JSON payload v.s. EventErrorPayload', async (t) => {
    const MESSAGE = 'test';
    const gerror = gerror_js_1.GError.fromJSON(new Error(MESSAGE));
    const obj = gerror.toJSON();
    t.notOk((0, puppet_js_1.isPuppetEventErrorPayload)(obj), 'should not pass the EventErrorPayload check');
});
(0, tstest_1.test)('GError.from(string) should have stack info', async (t) => {
    const e = gerror_js_1.GError.from('test');
    t.equal(e.name, 'GError', 'should be Error');
    t.ok(e.stack, 'should have stack info');
});
//# sourceMappingURL=gerror.spec.js.map