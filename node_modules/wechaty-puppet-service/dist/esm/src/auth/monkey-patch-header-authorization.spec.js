#!/usr/bin/env -S node --no-warnings --loader ts-node/esm
import { test } from 'tstest';
import { Metadata, } from './grpc-js.js';
import { monkeyPatchMetadataFromHttp2Headers } from './mokey-patch-header-authorization.js';
test('monkeyPatchMetadataFromHttp2Headers', async (t) => {
    const AUTHORITY = '__authority__';
    const headers = {
        ':authority': AUTHORITY,
    };
    const dispose = monkeyPatchMetadataFromHttp2Headers(Metadata);
    const meta = Metadata.fromHttp2Headers(headers);
    const authorization = meta.get('authorization')[0];
    const EXPECTED = `Wechaty ${AUTHORITY}`;
    t.equal(authorization, EXPECTED, 'should get authority from metadata');
    dispose();
});
//# sourceMappingURL=monkey-patch-header-authorization.spec.js.map